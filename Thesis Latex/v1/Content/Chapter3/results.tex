\section{Results of the Runtime Verified AV System}

This research provides a solution for two aspects of \acf{AV} systems: predicting accurately with perturbations to the system's inputs and safely dealing with misclassifications by the system.
The issue of input perturbations was addressed using a \acf{MNN} of different convolutional \acfp{SNN}, each \ac{SNN} working in tandem to predict more accurately.
Misclassification by the system's controller was addressed by implementing sensor fusion between cameras and \ac{LiDAR}.
This was done using a run-time enforcer that enforced a safety automaton.

\todo{fix results with new graphs}

To test the \ac{MNN}'s ability to deal with perturbations, the input images (taken from the \ac{VOC} 2012 and \ac{GTSRB} datasets) were perturbed by randomly replacing approximately 7\% of the image pixels with randomly coloured pixels.
Table~\ref{tbl:sign-res} shows that without perturbations, the accuracy of the \ac{MNN} was increased from 87.07\% to 93.7\% when using an enforced policy.
Table~\ref{tbl:sign-respert} shows that the accuracy of the \ac{MNN} hugely decreases when perturbations are present, from 87.07\% to 41.6\%.
However, with sensor fusion and a relative safety policy, the accuracy is increased to 90.48\%.
 
\begin{table}[h]
	\centering
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|p{0.17\linewidth}||p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|}
			\hline
			Object classified & No. of misclassifications (\%) & Caught misclassifications (\%) & False negatives (\%) & Uncaught misclassifications (\%) \\ \hline
			Person & 17.01 & 17.01 & 0.00 & 0.00 \\ \hline
			Vehicle & 15.85 & 15.85 & 0.00 & 0.00 \\ \hline
			Sign & 54.46 & 54.46 & 4.84 & 4.84 \\ \hline
			Nothing & 7.83 & 7.83 & 0.00 & 0.00 \\ \hline
			All & 95.16 & 95.16 & 4.84 & 4.84 \\ \hline
		\end{tabular}%
	}
	\caption{Table showing the worst results of the \ac{AV} prediction \ac{SNN} using the original images, trained for 0 epochs}
	\label{tbl:sign-res1}
\end{table}

\begin{table}[h]
	\centering
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|p{0.17\linewidth}||p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|}
			\hline
			Object classified & No. of misclassifications (\%) & Caught misclassifications (\%) & False negatives (\%) & Uncaught misclassifications (\%) \\ \hline
			Person & 1.00 & 0.21 & 0.53 & 1.32 \\ \hline
			Vehicle & 6.26 & 5.63 & 0.44 & 1.07 \\ \hline
			Sign & 2.62 & 0.44 & 1.02 & 3.20 \\ \hline
			Nothing & 2.50 & 2.27 & 0.12 & 0.35 \\ \hline
			All & 12.38 & 8.55 & 2.11 & 5.93 \\ \hline
		\end{tabular}%
	}
	\caption{Table showing results of the \ac{AV} prediction \ac{SNN} using the original images, trained for 10000 epochs}
	\label{tbl:sign-res10000}
\end{table}

\begin{table}[h]
	\centering
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|p{0.17\linewidth}||p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|}
			\hline
			Object classified & No. of misclassifications (\%) & Caught misclassifications (\%) & False negatives (\%) & Uncaught misclassifications (\%) \\ \hline
			Person & 1.11 & 0.70 & 0.65 & 1.07 \\ \hline
			Vehicle & 3.92 & 3.34 & 0.65 & 1.23 \\ \hline
			Sign & 2.64 & 0.60 & 0.51 & 2.55 \\ \hline
			Nothing & 2.92 & 2.69 & 0.23 & 0.46 \\ \hline
			All & 10.59 & 7.32 & 2.04 & 5.31 \\ \hline
		\end{tabular}%
	}
	\caption{Table showing the best results of the \ac{AV} prediction \ac{SNN} using the original images, trained for 6000 epochs}
	\label{tbl:sign-resbest}
\end{table}

\begin{table}[h]
	\centering
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|p{0.17\linewidth}||p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|}
			\hline
			Object classified & No. of misclassifications (\%) & Caught misclassifications (\%) & False negatives (\%) & Uncaught misclassifications (\%) \\ \hline
			Person & 17.01 & 17.01 & 0.00 & 0.00 \\ \hline
			Vehicle & 15.85 & 15.85 & 0.00 & 0.00 \\ \hline
			Sign & 54.46 & 54.46 & 4.84 & 4.84 \\ \hline
			Nothing & 7.83 & 7.83 & 0.00 & 0.00 \\ \hline
			All & 95.16 & 95.16 & 4.84 & 4.84 \\ \hline
		\end{tabular}%
	}
	\caption{Table showing the worst results of the \ac{AV} prediction \ac{SNN} using perturbed images, trained for 0 epochs}
	\label{tbl:sign-respert1}
\end{table}

\begin{table}[h]
	\centering
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|p{0.17\linewidth}||p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|}
			\hline
			Object classified & No. of misclassifications (\%) & Caught misclassifications (\%) & False negatives (\%) & Uncaught misclassifications (\%) \\ \hline
			Person & 3.43 & 0.60 & 0.56 & 3.38 \\ \hline
			Vehicle & 10.78 & 8.57 & 0.23 & 2.43 \\ \hline
			Sign & 38.08 & 31.91 & 1.39 & 7.56 \\ \hline
			Nothing & 5.61 & 4.80 & 0.09 & 0.90 \\ \hline
			All & 57.89 & 45.89 & 2.27 & 14.28 \\ \hline
		\end{tabular}%
	}
	\caption{Table showing results of the \ac{AV} prediction \ac{SNN} using perturbed images, trained for 10000 epochs}
	\label{tbl:sign-respert10000}
\end{table}

\begin{table}[h]
	\centering
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|p{0.17\linewidth}||p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|}
			\hline
			Object classified & No. of misclassifications (\%) & Caught misclassifications (\%) & False negatives (\%) & Uncaught misclassifications (\%) \\ \hline
			Person & 3.22 & 1.02 & 0.79 & 2.99 \\ \hline
			Vehicle & 9.20 & 7.25 & 0.53 & 2.48 \\ \hline
			Sign & 33.30 & 27.65 & 2.71 & 8.37 \\ \hline
			Nothing & 6.81 & 6.12 & 0.09 & 0.79 \\ \hline
			All & 52.54 & 42.04 & 4.13 & 14.62 \\ \hline
		\end{tabular}%
	}
	\caption{Table showing the best results of the \ac{AV} prediction \ac{SNN} using perturbed images, trained for 700 epochs}
	\label{tbl:sign-respertbest}
\end{table}

\begin{figure}[t]
	\centering
	\scalebox{1}{\input{Content/fig/sign-graph.tex}}
	\caption{Line graph showing the performance of the system trained over an increasing amount of epochs using unperturbed inputs \label{fig:sign-graph}}
\end{figure}

\begin{figure}[t]
	\centering
	\scalebox{1}{\input{Content/fig/sign-graphpert.tex}}
	\caption{Line graph showing the number of misclassifications made by the system with perturbed inputs \label{fig:sign-graphpert}}
\end{figure}

\begin{figure}[t]
	\centering
	\scalebox{1}{\input{Content/fig/sign-graphboth.tex}}
	\caption{Line graph showing the number of misclassifications made by the system with all inputs \label{fig:sign-graphboth}}
\end{figure}

%\todo{Add table showing how \ac{MNN} affects the prediction accuracy}

\subsection{An \ac{AV} System Using \acf{MNN2C}}
\ac{MNN2C}, introduced in Section~\ref{sec:mnn2c}, creates time-predictable, modular \acfp{MNN} for C from existing Keras (with Tensorflow) trained \acp{ANN}. 
This compiler makes implementing \acfp{SNN} in C easy and safe.
For the purposes of testing and demonstration, the complex \ac{MNN} used in this chapter, shown in Figure~\ref{fig:mnn}, was trained in Python, using Keras and the exact same images used to train the original system.
This \ac{MNN} was then described in the \ac{MNN2C} format, and modular C code was generated to initialise, run and incorporate the \ac{MNN}.
To show the efficacy of \ac{MNN2C}, the generated \ac{MNN} was implemented in an identical system to the original, and run with the same tests. 
It has already been shown that \ac{MNN2C} generates outputs identical to the Keras trained \acp{ANN} with a one hundred-thousandth tolerance, so the output of each individual \ac{ANN} is not being tested, rather that the system as a whole runs as the original does.
Additionally, the time-predictable \ac{MNN} was run through the Patmos \ac{WCET} tool in order to get the \ac{WCET} and \ac{WCRT} of the \ac{MNN}.

\subsubsection{Results of an \ac{MNN2C} Generated \ac{AV} System}
\begin{table}[h]
	\centering
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|p{0.17\linewidth}||p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|}
			\hline
			Object classified & No. of misclassifications (\%) & Caught misclassifications (\%) & False negatives (\%) & Uncaught misclassifications (\%) \\ \hline
			Person & 0.37 & 0.35 & 3.89 & 3.92 \\ \hline
			Vehicle & 8.67 & 8.53 & 1.62 & 1.76 \\ \hline
			Sign & 7.58 & 7.07 & 11.94 & 12.44 \\ \hline
			Nothing & 8.39 & 8.27 & 0.05 & 0.16 \\ \hline
			All & 25.01 & 24.22 & 17.50 & 18.29 \\ \hline
		\end{tabular}%
	}
	\caption{Table showing the best results of the \ac{AV} prediction \ac{MNN} using original images, generated by \ac{MNN2C} and trained for 100 epochs}
	\label{tbl:sign-resmnn}
\end{table}

\begin{table}[h]
	\centering
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|p{0.17\linewidth}||p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|p{0.17\linewidth}|}
			\hline
			Object classified & No. of misclassifications (\%) & Caught misclassifications (\%) & False negatives (\%) & Uncaught misclassifications (\%) \\ \hline
			Person & 0.23 & 0.23 & 5.26 & 5.26 \\ \hline
			Vehicle & 9.52 & 9.32 & 2.04 & 2.25 \\ \hline
			Sign & 23.75 & 21.69 & 14.14 & 16.20 \\ \hline
			Nothing & 8.44 & 8.37 & 0.00 & 0.07 \\ \hline
			All & 41.95 & 39.61 & 21.44 & 23.78 \\ \hline
		\end{tabular}%
	}
	\caption{Table showing the best results of the \ac{AV} prediction \ac{MNN} using perturbed images, generated by \ac{MNN2C} and trained for 100 epochs}
	\label{tbl:sign-resmnnpert}
\end{table}



















